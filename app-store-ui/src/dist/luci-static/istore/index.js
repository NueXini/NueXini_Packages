var Me=Object.defineProperty,Fe=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var xe=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var Ce=(n,e,t)=>e in n?Me(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,H=(n,e)=>{for(var t in e||(e={}))Ue.call(e,t)&&Ce(n,t,e[t]);if(xe)for(var t of xe(e))ze.call(e,t)&&Ce(n,t,e[t]);return n},ae=(n,e)=>Fe(n,Re(e));var qe=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var b=(n,e,t)=>new Promise((s,a)=>{var o=l=>{try{d(t.next(l))}catch(f){a(f)}},i=l=>{try{d(t.throw(l))}catch(f){a(f)}},d=l=>l.done?s(l.value):Promise.resolve(l.value).then(o,i);d((t=t.apply(n,e)).next())});import{a as re,c as Ge,u as V,b as M,d as P,r as X,o as u,e as _,F as L,f as z,g as Z,w as Ee,h as r,n as J,t as h,i as $,j as D,k as Ye,l as C,m as le,p as ie,q as p,s as R,v as ce,x as ue,y as De,z as Se,A as Ne,B as He,C as Qe,D as We,E as Ke,G as Ze,T as Je,H as Xe,I as se,J as te,K as Ae}from"./vendor.js?v=96cb1fcd";var Co=qe(S=>{const je=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}};je();const oe={tagMap:{},numberFormat:new Intl.NumberFormat("en",{notation:"compact"})},et=n=>b(S,null,function*(){const e=window.vue_lang;new Date().getTime();let t={};try{const o=yield re({url:window.vue_lang_data,method:"GET"});o.data&&(t=o.data)}catch(o){console.log(o)}const s=Ge({defaultLanguage:e,translations:t,setGlobalProperties:!1,provideDirective:!1,provideComponent:!1});n.use(s);const{$gettext:a}=s;window.$i18n=a,oe.tagMap={net:a("net"),tool:a("tool"),download:a("download"),service:a("service"),multimedia:a("multimedia"),nas:a("nas"),monitor:a("monitor"),system:a("system"),networking:a("networking"),broken:a("Broken")};try{oe.numberFormat=new Intl.NumberFormat(e,{notation:"compact"})}catch(o){console.error("Intl.NumberFormat unsupported lang",e,o)}}),Ve=n=>oe.tagMap[n]||n,Le=n=>typeof n=="number"?oe.numberFormat.format(n):"?";var T=(n,e)=>{const t=n.__vccOpts||n;for(const[s,a]of e)t[s]=a;return t};const tt={class:"tabs"},nt=["href","onClick"],at={key:0},st={__name:"index",setup(n){const{$gettext:e}=V(),t=M(),s=P(()=>t.state.version),a=P(()=>[{to:"/installed",name:e("installed")},{to:"/store",name:e("all app")},{to:"/upload",name:e("manual install")},{to:"/maintance",name:e("maintain"),up:s.value}]);return(o,i)=>{const d=X("router-link");return u(),_("ul",tt,[(u(!0),_(L,null,z(a.value,l=>(u(),Z(d,{to:l.to,custom:"",key:l.to},{default:Ee(({href:f,navigate:A,isActive:E})=>[r("li",{class:J(E&&"active cbi-tab")},[r("a",{href:f,onClick:A},h(l.name),9,nt),l.up?(u(),_("span",at)):$("",!0)],2)]),_:2},1032,["to"]))),128)),i[0]||(i[0]=r("div",{class:"auto"},null,-1))])}}};var ot=T(st,[["__scopeId","data-v-13251538"]]);const rt={__name:"App",setup(n){return M().dispatch("getData"),(t,s)=>{const a=X("router-view");return u(),_(L,null,[D(ot),D(a)],64)}}},lt=()=>window.vue_base,it=()=>window.istore_api_base||"https://istore.istoreos.com",ct=()=>window.istore_icon_base||"https://istore.linkease.com.cdn.koolcenter.com",ut=n=>{if(n)return Ye(n).format("YYYY-MM-DD HH:mm:ss")},dt=()=>new Date().getTime(),pt=n=>{if(n<1024)return""+n+"KB";let t=1024,s=0;for(let o=n/1024;o>=1024;o/=1024)t*=1024,s++;let a=["M","G","T","P","E"];return(n/100/(t/100)).toFixed(2)+a[s]},_t=n=>{if(n==null)return 0;if(n<1e4)return n;let t=parseInt(`${n/1e4}`),s=n%1e4;return`${t}\u4E07${s}`},vt=()=>window.token||"",ht=()=>{var n;return((n=window==null?void 0:window.device_id)==null?void 0:n.uid)||""},mt=()=>{var n;return((n=window==null?void 0:window.istore_config)==null?void 0:n.channel)||""},ft=()=>{var n;return((n=window==null?void 0:window.device_id)==null?void 0:n.version)||""},gt=()=>{var n;return((n=window==null?void 0:window.device_id)==null?void 0:n.arch)||""},bt=()=>"https://www.kooldns.cn/bind",kt=()=>window.istore_features||[];var yt=Object.freeze(Object.defineProperty({__proto__:null,BasePage:lt,ApiBaseURL:it,IconBaseURL:ct,formatDate:ut,UnixDate:dt,numberToSize:pt,numberToSum:_t,getToken:vt,getDeviceId:ht,getChannel:mt,getVersion:ft,modelArch:gt,getIframeURL:bt,getFeatures:kt},Symbol.toStringTag,{value:"Module"})),I=H({},yt);const O=re.create({});O.interceptors.request.use(n=>(n.params==null&&(n.params={}),n.params=ae(H({},n.params),{token:I.getToken(),_t:I.UnixDate()}),n),n=>n);O.interceptors.response.use(n=>n,n=>n);const W=re.create({baseURL:I.ApiBaseURL()});W.interceptors.request.use(n=>(n.params==null&&(n.params={}),n.params=ae(H({},n.params),{modelArch:I.modelArch(),deviceId:I.getDeviceId(),channel:I.getChannel(),_t:I.UnixDate()}),n),n=>n);W.interceptors.response.use(n=>n);const wt=()=>new Promise((n,e)=>b(S,null,function*(){try{const t=yield O({method:"GET",url:"/cgi-bin/luci/admin/store/installed"});if(t.status==200){n(t.data);return}e(t.status);return}catch(t){e(t);return}})),$t=(n,e)=>new Promise((t,s)=>b(S,null,function*(){const a={package:n};e&&(a.autoconf=1,a.path=e.path,a.enable=e.enable);try{const o=yield O({method:"POST",url:"/cgi-bin/luci/admin/store/install",params:a});if(o.status==200){t(o.data);return}s(o.status);return}catch(o){s(o);return}})),xt=n=>new Promise((e,t)=>b(S,null,function*(){try{const s=yield O({method:"POST",url:"/cgi-bin/luci/admin/store/upgrade",params:{package:n}});if(s.status==200){e(s.data);return}t(s.status);return}catch(s){t(s);return}})),Ct=n=>new Promise((e,t)=>b(S,null,function*(){try{const s=yield O({method:"POST",url:"/cgi-bin/luci/admin/store/remove",params:{package:n}});if(s.status==200){e(s.data);return}t(s.status);return}catch(s){t(s);return}})),St=()=>new Promise((n,e)=>b(S,null,function*(){try{const t=yield O({method:"POST",url:"/cgi-bin/luci/admin/store/update"});if(t.status==200){n(t.data);return}e(t.status);return}catch(t){e(t);return}})),At=n=>new Promise((e,t)=>b(S,null,function*(){try{const s=yield O({method:"GET",url:"/cgi-bin/luci/admin/store/status",params:{package:n}});if(s.status==200){e(s.data);return}t(s.status);return}catch(s){t(s);return}})),Lt=n=>new Promise((e,t)=>b(S,null,function*(){try{const s=yield O({method:"POST",url:"/cgi-bin/luci/admin/store/upload",headers:{"Content-Type":"multipart/form-data"},data:n});if(s.data){e(s.data);return}}catch(s){t(s);return}t("not found soft")})),Tt=()=>new Promise((n,e)=>b(S,null,function*(){try{const t=yield O({method:"POST",url:"/cgi-bin/luci/admin/store/light_backup"});if(t.status==200){n(t.data);return}e(t.status);return}catch(t){e(t);return}})),It=n=>new Promise((e,t)=>b(S,null,function*(){try{const s=yield O({method:"POST",url:"/cgi-bin/luci/admin/store/light_restore",headers:{"Content-Type":"multipart/form-data"},data:n});if(s.data){e(s.data);return}}catch(s){t(s);return}t("not found soft")})),Ot=(n,e)=>new Promise((t,s)=>b(S,null,function*(){try{const a=yield O({method:"GET",url:"/cgi-bin/luci/admin/store/get_available_backup_file_list",params:{path:n,type:e}});if(a.status==200){t(a==null?void 0:a.data);return}s(a.status);return}catch(a){s(a);return}})),Pt=()=>new Promise((n,e)=>b(S,null,function*(){try{const t=yield O({method:"GET",url:"/cgi-bin/luci/admin/store/get_local_backup_dir_path"});if(t.status==200){n(t==null?void 0:t.data);return}e(t.status);return}catch(t){e(t);return}})),Et=(n,e)=>new Promise((t,s)=>b(S,null,function*(){try{const a=yield O({method:"POST",url:"/cgi-bin/luci/admin/store/local_backup",params:{path:n,type:e}});if(a.status==200){t(a==null?void 0:a.data);return}s(a.status);return}catch(a){s(a);return}})),Dt=(n,e)=>new Promise((t,s)=>b(S,null,function*(){try{const a=yield O({method:"POST",url:"/cgi-bin/luci/admin/store/local_restore",params:{path:n,type:e}});if(a.status==200){t(a.data);return}s(a.status);return}catch(a){s(a);return}})),Vt=()=>new Promise((n,e)=>b(S,null,function*(){try{const t=yield O({method:"GET",url:"/cgi-bin/luci/admin/store/get_block_devices"});if(t.status==200){n(t==null?void 0:t.data);return}e(t.status);return}catch(t){e(t);return}})),Bt=n=>new Promise((e,t)=>b(S,null,function*(){try{const s=yield O({method:"POST",url:"/cgi-bin/luci/admin/store/toggle_docker",params:{hide:n}});if(s.status==200){e(s.data);return}t(s.status);return}catch(s){t(s);return}})),Mt=n=>new Promise((e,t)=>b(S,null,function*(){try{const s=yield O({method:"POST",url:"/cgi-bin/luci/admin/store/toggle_arch",params:{ignore:n}});if(s.status==200){e(s.data);return}t(s.status);return}catch(s){t(s);return}}));var Ft=Object.freeze(Object.defineProperty({__proto__:null,getInstalledApp:wt,installApp:$t,upgradeApp:xt,removeApp:Ct,updateAppStore:St,getAppStatus:At,uploadAppIPK:Lt,lightBackup:Tt,lightRestore:It,backupFileList:Ot,localBackupdirPath:Pt,localBackup:Et,localRestore:Dt,getBlockDevices:Vt,toggleDocker:Bt,toggleArch:Mt},Symbol.toStringTag,{value:"Module"}));const Rt=n=>new Promise((e,t)=>b(S,null,function*(){var s,a,o,i;try{const d=yield W({method:"GET",url:"/api/store/list",params:n});if(((s=d==null?void 0:d.data)==null?void 0:s.success)===0){e((a=d==null?void 0:d.data)==null?void 0:a.result);return}if((o=d==null?void 0:d.data)!=null&&o.message){t((i=d==null?void 0:d.data)==null?void 0:i.message);return}t("error")}catch(d){console.log(d),t(d);return}})),Ut=(n,e)=>new Promise((t,s)=>b(S,null,function*(){var a,o,i,d;try{const l=yield W({method:"POST",url:"/api/store/list",params:n,data:e});if(((a=l==null?void 0:l.data)==null?void 0:a.success)===0){t((o=l==null?void 0:l.data)==null?void 0:o.result);return}if((i=l==null?void 0:l.data)!=null&&i.message){s((d=l==null?void 0:l.data)==null?void 0:d.message);return}s("error")}catch(l){console.log(l),s(l);return}})),zt=I.IconBaseURL(),qt=n=>`${zt}${n}`,Gt=()=>new Promise((n,e)=>b(S,null,function*(){var t,s,a,o;try{const i=yield W({method:"GET",url:"/api/store/tags"});if(((t=i==null?void 0:i.data)==null?void 0:t.success)===0){n((s=i==null?void 0:i.data)==null?void 0:s.result);return}if((a=i==null?void 0:i.data)!=null&&a.message){e((o=i==null?void 0:i.data)==null?void 0:o.message);return}e("error")}catch(i){e(i);return}})),Yt=n=>new Promise((e,t)=>{W({method:"POST",url:"/api/store/expand",data:{appsId:n||[],deviceId:I.getDeviceId()}}).then(s=>{var a,o,i;if(((a=s.data)==null?void 0:a.success)==0&&((o=s.data)==null?void 0:o.result)){e((i=s.data)==null?void 0:i.result);return}t("not found expand")}).catch(s=>{t(s)})}),Nt=n=>{W({method:"POST",url:"/api/store/download",data:{appId:n,deviceId:I.getDeviceId()}}).then(e=>{var t;((t=e.data)==null?void 0:t.success)!=0})},Ht=n=>new Promise((e,t)=>{W({method:"POST",url:"/api/store/star",data:{appId:n,deviceId:I.getDeviceId()}}).then(s=>{var a;if(((a=s.data)==null?void 0:a.success)==0){e(s.data);return}t("not found expand")}).catch(s=>{t(s)})});var Qt=Object.freeze(Object.defineProperty({__proto__:null,getStoreAppList:Rt,postStoreAppList:Ut,getStoreAppIcon:qt,getStoreTags:Gt,getAppExpandData:Yt,increasingDownloadCount:Nt,postStarApp:Ht},Symbol.toStringTag,{value:"Module"}));const Wt=()=>O({method:"GET",url:"/cgi-bin/luci/admin/store/check_self_upgrade"}),Kt=()=>O({method:"POST",url:"/cgi-bin/luci/admin/store/do_self_upgrade"});var Zt=Object.freeze(Object.defineProperty({__proto__:null,updateIstore:Wt,selfUpdateIstore:Kt},Symbol.toStringTag,{value:"Module"})),x=H(H(H({},Ft),Qt),Zt);const Jt={class:"toast"},Xt=["title"],jt={key:1,class:"msg"},en=["innerHTML"],tn={__name:"index",props:{content:String,type:String,Close:Function,keep:Boolean,html:Boolean},setup(n){const e=n,t=C(e.content),s=C(e.keep),a=C(e.html),o=C(window.$i18n);e.keep||setTimeout(()=>{e.Close()},2e3);const i=()=>{e.Close()};return(d,l)=>(u(),_("div",Jt,[s.value?(u(),_("div",{key:0,class:"toast-close",onClick:i,title:o.value("closed")},"x",8,Xt)):$("",!0),a.value?$("",!0):(u(),_("div",jt,h(t.value),1)),a.value?(u(),_("div",{key:2,class:"msg",innerHTML:t.value},null,8,en)):$("",!0)]))}};var nn=T(tn,[["__scopeId","data-v-b05f92bc"]]);const w=n=>{let e={content:"",type:"",keep:!1,html:!1,Close:()=>{s.unmount(t),document.body.removeChild(t)}};n!=null&&(typeof n=="object"?(e.content=(n==null?void 0:n.content)||"",e.type=(n==null?void 0:n.type)||"",e.keep=(n==null?void 0:n.keep)||!1,e.html=(n==null?void 0:n.html)||!1):e.content=n);let t=document.createElement("div"),s=le(nn,e);document.body.append(t),s.mount(t),ie(()=>{s.unmount(t),document.body.removeChild(t)})},an={props:{content:String,Close:Function},setup(n){return{message:n.content}}},sn={class:"loading"},on={class:"msg"};function rn(n,e,t,s,a,o){return u(),_("div",sn,[e[0]||(e[0]=r("div",{class:"icon"},null,-1)),r("div",on,h(s.message),1)])}var ln=T(an,[["render",rn],["__scopeId","data-v-6d7664a4"]]),U={props:{content:"",Close:()=>{}},Start(n){this.props={content:n,Close:()=>{e.unmount(t),document.body.removeChild(t)}};let e=le(ln,this.props),t=document.createElement("div");document.body.append(t),e.mount(t),ie(()=>{this.props.Close()})},Stop(){this.props.Close()}};const G=n=>!Array.isArray(window.istore_features)||window.istore_features.indexOf(n)!=-1,cn={class:"app-container"},un={class:"app-info"},dn={class:"app-f"},pn={class:"app-icon"},_n=["alt","src"],vn={key:0,class:"docker-icon-i"},hn={class:"app-tags"},mn={class:"tag"},fn={class:"app-r"},gn=["title"],bn={class:"app-name"},kn={class:"app-version"},yn={class:"app-as"},wn=["title"],$n=["title"],xn=["title"],Cn={class:"app-author"},Sn={class:"app-date"},An={class:"app-btns"},Ln=["href"],Tn=["href"],In=["href"],On=["title"],Pn={__name:"index",props:{col:{type:Object,default(){return{description:"",tags:[],entry:"",author:"",depends:[],installed:!1,hasupdate:!1,broken:!1,title:"",time:"",release:1,website:"",name:"",version:""}}}},setup(n){const{$gettext:e,$ngettext:t}=V(),s=n,a=P(()=>s.col),o=M(),i=I.formatDate;I.numberToSum;const d=k=>{x.upgradeApp(k).then(c=>{let v=c.stderr;c.code!==0?w({content:`${v}
${e("update failed with error code")}: ${c.code}`,keep:!0}):window.istore_log(!0)}).catch(c=>{w({content:`${e("update failed with error code")}: ${500}`,keep:!0})})},l=(k,c)=>{c&&!G("docker")&&!confirm(e("Docker is not installed on the system, try to install it?"))||x.installApp(k).then(v=>{let m=v.stderr;v.code!==0?w({content:`${m}
${e("installation failed, error code")}: ${v.code}`,keep:!0}):(x.increasingDownloadCount(k),o.dispatch("apps/incrAppDownload",{name:k}),window.istore_log(!0,g=>{console.log("Install ",k," ",g==0?"successed":"failed")}))}).catch(v=>{w({content:`${e("installation failed, error code")}: ${500}`,keep:!0})})},f=k=>{!confirm(e("are you sure you want to uninstall %{name}?",{name:k}))||x.removeApp(k).then(v=>{let m=v.stderr;v.code!==0?w({content:`${m}
${e("uninstall failed, error code")}: ${v.code}`,keep:!0}):window.istore_log(!0)}).catch(v=>{w({content:`${e("uninstall failed, error code")}: ${500}`,keep:!0})})},A=k=>b(this,null,function*(){U.Start();try{(yield x.postStarApp(k))&&o.dispatch("apps/incrAppStar",{name:k})}catch(c){}U.Stop()}),E=()=>{w(e("you have already liked"))},Y=k=>a.value.installed?`/luci-static/resources/app-icons/${k}.png`:a.value.icon?x.getStoreAppIcon(a.value.icon):`/luci-static/resources/app-icons/${k}.png`,N=k=>{switch(window.vue_lang){case"zh-cn":case"zh-tw":return k.title}return k.title_en||k.title},K=k=>{switch(window.vue_lang){case"zh-cn":case"zh-tw":return k.description}return k.description_en||k.description},F=k=>{o.dispatch("apps/stickTop",k)},j=P(()=>a.value.uci&&a.value.autoconf&&a.value.autoconf.length>0),ee=()=>b(this,null,function*(){window.$openGlobalQuickInstalled({app:a.value})});return(k,c)=>{var y,ne,de,pe,_e,ve,he,me,fe,ge,be,ke,ye,we,$e;const v=X("svg-docker"),m=X("svg-star-off"),g=X("svg-star-on");return u(),_("div",cn,[r("div",un,[r("div",dn,[r("div",pn,[r("img",{alt:p(e)("Icon is gone")+"~",src:Y(a.value.name)},null,8,_n),!a.value.broken&&a.value.depends.indexOf("docker-deps")!=-1?(u(),_("i",vn,[D(v,{class:"docker-icon"})])):$("",!0)]),r("div",hn,[(u(!0),_(L,null,z(a.value.tags,q=>(u(),_(L,{key:q},[r("div",mn,[r("span",null,h(p(Ve)(q)),1)]),c[7]||(c[7]=r("span",{class:"block"},"\uFF5C",-1))],64))),128))])]),r("div",fn,[r("div",{class:"app-title",title:a.value.name},[r("span",bn,h(N(a.value)),1),r("span",kn,"v"+h(a.value.version),1)],8,gn),r("div",yn,[r("span",null,h(p(t)("%{ num } download","%{ num } downloads",((ne=(y=a.value)==null?void 0:y.expand)==null?void 0:ne.downloadCount)||0,{num:p(Le)((pe=(de=a.value)==null?void 0:de.expand)==null?void 0:pe.downloadCount)})),1),c[8]||(c[8]=r("span",{style:{margin:"0 10px"}},"|",-1)),r("span",null,h(p(t)("%{ num } like","%{ num } likes",((ve=(_e=a.value)==null?void 0:_e.expand)==null?void 0:ve.starCount)||0,{num:p(Le)((me=(he=a.value)==null?void 0:he.expand)==null?void 0:me.starCount)})),1),((fe=a.value)==null?void 0:fe.expand)!=null?(u(),_(L,{key:0},[(be=(ge=a.value)==null?void 0:ge.expand)!=null&&be.isStar?(u(),_("a",{key:0,class:"star-btn",title:p(e)("liked"),onClick:c[0]||(c[0]=q=>E())},[D(m)],8,wn)):(u(),_("a",{key:1,class:"star-btn",title:p(e)("like"),onClick:c[1]||(c[1]=q=>A(a.value.name))},[D(g)],8,$n))],64)):$("",!0)]),r("div",{class:"app-description cbi-value-description",title:K(a.value)},[r("span",null,h(K(a.value)),1)],8,xn),r("div",Cn,[r("span",null,h(p(e)("author"))+": "+h(a.value.author||"null"),1)]),r("div",Sn,[r("span",null,h(p(e)("update date"))+": "+h(p(i)(a.value.time*1e3)||"null"),1)])])]),r("div",An,[a.value.tutorial?(u(),_("a",{key:0,class:"app-btn cbi-button cbi-button-apply",target:"_blank",href:a.value.tutorial},h(p(e)("tutorial")),9,Ln)):a.value.website?(u(),_("a",{key:1,class:"app-btn cbi-button cbi-button-apply",target:"_blank",href:a.value.website},h(p(e)("website")),9,Tn)):$("",!0),c[12]||(c[12]=r("div",{class:"auto"},null,-1)),a.value.installed?(u(),_(L,{key:2},[!a.value.broken&&(((ke=a.value)==null?void 0:ke.curVersion)!=((ye=a.value)==null?void 0:ye.lastVersion)||((we=a.value)==null?void 0:we.curRelease)!=(($e=a.value)==null?void 0:$e.lastRelease))?(u(),_(L,{key:0},[c[9]||(c[9]=r("div",{class:"app-margin-left"},null,-1)),r("a",{class:"app-btn cbi-button cbi-button-reload",onClick:c[2]||(c[2]=q=>d(a.value.name))},h(p(e)("upgrade")),1)],64)):$("",!0),c[10]||(c[10]=r("div",{class:"app-margin-left"},null,-1)),!a.value.broken&&a.value.entry?(u(),_("a",{key:1,class:"app-btn cbi-button cbi-button-apply",href:a.value.entry},h(p(e)("open")),9,In)):$("",!0),c[11]||(c[11]=r("div",{class:"app-margin-left"},null,-1)),r("a",{class:"app-btn cbi-button cbi-button-remove",onClick:c[3]||(c[3]=q=>f(a.value.name))},h(p(e)("uninstall")),1)],64)):(u(),_(L,{key:3},[j.value?(u(),_("a",{key:0,class:"app-btn cbi-button cbi-button-add",onClick:c[4]||(c[4]=q=>ee())},h(p(e)("quickinstall")),1)):(u(),_("a",{key:1,class:"app-btn cbi-button cbi-button-add",onClick:c[5]||(c[5]=q=>l(a.value.name,a.value.depends.indexOf("docker-deps")!=-1))},h(p(e)("install")),1))],64))]),r("span",{class:"fav-icon-i",onClick:c[6]||(c[6]=q=>F(a.value.name)),title:p(e)("Stick to the top")},"\u21EA",8,On)])}}};var En=T(Pn,[["__scopeId","data-v-b72905ea"]]);const Dn={class:"containers"},Vn={__name:"apps",props:{apps:{type:Array,default(){return[]}}},setup(n){const e=n,t=P(()=>e.apps);return(s,a)=>(u(),_("div",Dn,[(u(!0),_(L,null,z(t.value,o=>(u(),Z(En,{key:o.name,col:o},null,8,["col"]))),128))]))}};var Be=T(Vn,[["__scopeId","data-v-1a865b74"]]);const Bn={class:"cbi-section"},Mn={__name:"index",setup(n){const e=M(),t=P(()=>e.getters["apps/LocalApps"]);return(s,a)=>(u(),_("fieldset",Bn,[D(Be,{class:"app-list-installed",apps:t.value},null,8,["apps"])]))}};var Fn=T(Mn,[["__scopeId","data-v-bb2340b4"]]);const Rn={class:"sort-container"},Un={class:"sort-title"},zn={class:"sort-value"},qn=["value","onClick"],Gn={__name:"sort",setup(n){const{$gettext:e}=V(),t=C("default"),s=M(),a=C([{key:e("default"),value:"default"},{key:e("By download"),value:"download"},{key:e("By rating"),value:"star"},{key:e("Latest update"),value:"updateDate"}]),o=i=>{t.value=i,s.dispatch("apps/filterCurApps",{sort:i})};return(i,d)=>(u(),_("div",Rn,[r("div",Un,h(p(e)("order"))+":",1),r("div",zn,[(u(!0),_(L,null,z(a.value,l=>(u(),_("input",{key:l.value,class:J(["cbi-button",{"cbi-button-apply":t.value==l.value}]),type:"button",value:l.key,onClick:f=>o(l.value)},null,10,qn))),128))])]))}};var Yn=T(Gn,[["__scopeId","data-v-9f592bc6"]]);const Nn={class:"tags-container"},Hn={class:"tags-title"},Qn={class:"tags-value"},Wn=["value"],Kn=["value","onClick"],Zn={__name:"tag",setup(n){const{$gettext:e}=V(),t=C("default"),s=M(),a=P(()=>s.getters["tags/Tags"]),o=i=>{t.value=i,s.dispatch("apps/filterCurApps",{tag:i})};return(i,d)=>(u(),_("div",Nn,[r("div",Hn,h(p(e)("tag"))+": ",1),r("div",Qn,[r("input",{class:J(["cbi-button",{"cbi-button-apply":t.value=="default"}]),type:"button",value:p(e)("default"),onClick:d[0]||(d[0]=l=>o("default"))},null,10,Wn),(u(!0),_(L,null,z(a.value,l=>(u(),_("input",{key:l,class:J(["cbi-button",{"cbi-button-apply":t.value==l}]),type:"button",value:p(Ve)(l),onClick:f=>o(l)},null,10,Kn))),128))])]))}};var Jn=T(Zn,[["__scopeId","data-v-07bccc36"]]);const Xn=["placeholder"],jn={__name:"search",setup(n){const{$gettext:e}=V(),t=C(""),s=M(),a=()=>{s.dispatch("apps/filterCurApps",{search:t.value})};return(o,i)=>{const d=X("svg-search");return u(),_("form",{class:"search",onSubmit:ue(a,["prevent"])},[r("a",{class:"search-btn",onClick:a},[D(d)]),R(r("input",{type:"text",placeholder:p(e)("please enter the search keyword"),"onUpdate:modelValue":i[0]||(i[0]=l=>t.value=l)},null,8,Xn),[[ce,t.value,void 0,{trim:!0}]])],32)}}};var ea=T(jn,[["__scopeId","data-v-c4e8a9f2"]]);const ta={key:1,style:{margin:"10px 0","text-align":"center",width:"100%"}},na={__name:"apps",setup(n){const{$gettext:e}=V(),t=M(),s=P(()=>t.getters["apps/StoreApps"]),a=P(()=>t.state.apps.Load);return(o,i)=>a.value?(u(),Z(Be,{key:0,apps:s.value},null,8,["apps"])):(u(),_("span",ta,h(p(e)("loading data"))+"...",1))}},aa={class:"cbi-section"},sa={__name:"index",setup(n){return(e,t)=>(u(),_("fieldset",aa,[D(ea),D(Jn),D(Yn),D(na)]))}};var oa=T(sa,[["__scopeId","data-v-74b0669f"]]);const ra={class:"cbi-section"},la={class:"container_msg cbi-map-descr"},ia={class:"upload-file"},ca={class:"button"},ua={__name:"index",setup(n){const{$gettext:e}=V(),t=C(null),s=C(null);De(()=>{if(t.value){const d=t.value;d.addEventListener("dragenter",l=>{(l.fromElement===null||!d.contains(l.fromElement))&&console.log("dragenter")},!1),d.addEventListener("dragleave",l=>{(l.fromElement===null||!d.contains(l.fromElement))&&console.log("dragleave")},!1),d.addEventListener("dragover",l=>{l.preventDefault(),l.dataTransfer.dropEffect="link"},!1),d.addEventListener("drop",l=>{console.log("drop"),l.preventDefault(),a(l)},!1)}});const a=d=>{const l=d.dataTransfer.files;if(l&&l.length>0){const f=l[0];i(f);return}},o=d=>{const l=d.target.files;if(l&&l.length>0){const f=l[0];i(f);return}},i=d=>{if(d.name.endsWith(".run")||d.name.endsWith(".ipk")){let l=new FormData;l.append(d.name,d),U.Start(`${e("uploading")}...`),x.uploadAppIPK(l).then(f=>{let A=f.stderr;f.code!==0?Toast({content:`${A}
${e("offline installation failed with error code")}: ${f.code}`,keep:!0}):window.istore_log(!0)}).catch(f=>{Toast({content:`${e("offline installation failed with error code")}: ${500}`,keep:!0})}).finally(()=>{U.Stop()})}};return(d,l)=>{var f;return u(),_("fieldset",ra,[r("div",la,[r("span",null,h(p(e)("offline install")),1),r("span",null,"\xB7 "+h(p(e)("in this page, you can upload and install packages")),1),r("span",null,"\xB7 "+h(p(e)("supports .ipk packages, .run self-extracting packages")),1),r("span",null,"\xB7 "+h(p(e)("packages installed offline may not appear in iStore")),1)]),r("form",{onSubmit:ue(i,["prevent"])},[r("div",{class:"flex",ref_key:"upl",ref:t},[r("label",ia,[r("span",null,h(((f=s.value)==null?void 0:f.name)||p(e)("no files selected")),1),r("input",{type:"file",name:"file",accept:".ipk, .run",hidden:"",onChange:o},null,32),r("div",ca,h(p(e)("select or drag and drop files")),1)]),l[0]||(l[0]=r("div",{class:"auto"},null,-1))],512)],32)])}}};var da=T(ua,[["__scopeId","data-v-0b0723c2"]]);const pa={class:"cbi-section"},_a={class:"webapp-container"},va=["src"],ha={__name:"index",setup(n){const e=P(()=>""),t=P(()=>""),s=P(()=>`${I.getIframeURL()}/#/apps?token=${t.value}&deviceId=${e.value}`);return(a,o)=>(u(),_("fieldset",pa,[r("div",_a,[r("iframe",{src:s.value,sandbox:"allow-scripts allow-same-origin allow-popups",seamless:""},null,8,va)])]))}};var ma=T(ha,[["__scopeId","data-v-8e330954"]]);const fa={class:"log-containers"},ga={key:0,class:"containers-tit"},ba={key:1,class:"containers-tit"},ka=["value"],ya={key:1},wa={__name:"update",setup(n){const{$gettext:e}=V(),t=M(),s=P(()=>t.state.version),a=P(()=>t.state.versionLoad),o=()=>{U.Start(`${e("updateing")}...`),x.selfUpdateIstore().then(({data:i})=>{if(i){const{stdout:d,stderr:l,code:f}=i;if(f==0){w({content:`${e("update success, reloading")}...`,keep:!0}),t.dispatch("istoreUpdated"),setTimeout(()=>{location.href=location.href},1e3);return}else throw l||"unknown error"}throw"unknown error"}).catch(i=>{w(`${e("update error")}: ${i}`)}).finally(()=>{U.Stop()})};return(i,d)=>(u(),_("div",fa,[a.value?(u(),_("div",ba,[s.value?(u(),_(L,{key:0},[r("span",null,h(p(e)("last version"))+":"+h(s.value),1),r("input",{type:"button",class:"app-btn cbi-button cbi-button-apply",onClick:d[0]||(d[0]=l=>o()),value:p(e)("click to update")},null,8,ka)],64)):(u(),_("span",ya,h(p(e)("the is last version"))+"...",1))])):(u(),_("div",ga,h(p(e)("checking for latest version")),1))]))}};var $a=T(wa,[["__scopeId","data-v-1c49c730"]]);const xa={class:"log-containers"},Ca={class:"containers-tit"},Sa=["disabled","value"],Aa=["disabled","value"],La={__name:"config",setup(n){const{$gettext:e}=V(),t=M(),s=P(()=>t.state.apps.Cur.hide_docker),a=P(()=>t.state.apps.Cur.ignore_arch),o=C(!1),i=()=>{o.value=!0;let l=!s.value;window.istore_config.hide_docker=l,t.dispatch("apps/filterCurApps",{hide_docker:l}),x.toggleDocker(l).finally(()=>{o.value=!1})},d=()=>{o.value=!0;let l=!a.value;window.istore_config.ignore_arch=l,t.dispatch("apps/filterCurApps",{ignore_arch:l}),x.toggleArch(l).finally(()=>{o.value=!1})};return(l,f)=>(u(),_("div",xa,[r("div",Ca,[r("input",{disabled:o.value,type:"button",class:"app-btn cbi-button cbi-button-apply",onClick:f[0]||(f[0]=A=>i()),value:s.value?p(e)("show docker packages"):p(e)("hide docker packages")},null,8,Sa),r("input",{disabled:o.value,type:"button",class:"app-btn cbi-button cbi-button-apply",onClick:f[1]||(f[1]=A=>d()),value:a.value?p(e)("hide incompatible packages"):p(e)("show incompatible packages")},null,8,Aa)])]))}};var Ta=T(La,[["__scopeId","data-v-11c2d129"]]);const Ia={class:"Lightweight"},Oa={class:"Lightweight-container"},Pa={class:"model"},Ea={class:"Lightweight-container1"},Da={class:"container1-center"},Va={class:"Lightweight-tit"},Ba={class:"Lightweight-backup"},Ma=["value"],Fa=["value"],Ra={__name:"lightBackup",setup(n){const{$gettext:e}=V(),t=C(null),s=()=>{const d=e("backuping"),l=e("backup success"),f=e("backup fail"),A=e("click to download");U.Start(`${d}...`),x.lightBackup().then(E=>{if(E){const{msg:Y,code:N}=E;if(N==200){w({content:`${l}\uFF0C<a href="/cgi-bin/luci/admin/store/get_light_backup_file" target="_blank">${A}</a><br/><br/>`,keep:!0,html:!0});return}else throw Y||"unknown error"}throw"unknown error"}).catch(E=>{w(`${f} : ${E}`)}).finally(()=>{U.Stop()})},a=d=>{const l=d.target.files;if(l&&l.length>0){const f=l[0];o(f);return}},o=d=>{let l=new FormData;l.append(d.name,d),U.Start(`${e("uploading")}...`),x.lightRestore(l).then(f=>{let A=f.stderr;f.code!==0?w({content:`${A}
${e("restore failed with error code")}: ${f.code}`,keep:!0}):window.istore_log(!0)}).catch(f=>{w({content:`${e("restore failed with error code")}: ${500}`,keep:!0})}).finally(()=>{U.Stop()})},i=d=>{t.value.click(d),d.preventDefault()};return(d,l)=>(u(),_("div",Ia,[r("div",Oa,[r("div",Pa,h(p(e)("explain")),1),r("div",Ea,[r("div",Da,[r("div",Va,[r("span",null,"\xB7 "+h(p(e)("backup now will download a list of iStore installed software")),1),r("span",null,"\xB7 "+h(p(e)("upload software list and install from iStore when restoring")),1)]),r("div",Ba,[r("input",{type:"button",class:"app-btn cbi-button cbi-button-apply",onClick:s,value:p(e)("backup now")},null,8,Ma),r("input",{type:"file",name:"file",accept:".tar, .gz",hidden:"",onChange:a,ref_key:"upl",ref:t},null,544),r("input",{type:"button",class:"app-btn cbi-button cbi-button-apply",onClick:i,value:p(e)("restore backup")},null,8,Fa)])])])])]))}};var Ua=T(Ra,[["__scopeId","data-v-093203ae"]]);const za={class:"local"},qa={class:"local-container"},Ga={class:"model"},Ya={class:"local-container1"},Na={class:"container1-center"},Ha={class:"local-tit"},Qa={key:0},Wa={key:1},Ka={key:2},Za={key:3},Ja={key:4},Xa={key:5},ja={key:6},es={class:"local-device"},ts={class:"local-input"},ns={value:"",disabled:""},as=["value"],ss={value:"-"},os=["placeholder"],rs={key:2,class:"local-btn"},ls=["value"],is=["value"],cs={key:0,class:"device-list"},us=["value"],ds=["value"],B={ISTORE:"istore",OVERLAY:"overlay"},ps={__name:"localBackup",props:{backupType:{type:String,required:!0,validator:n=>Object.values(B).includes(n)}},setup(n){const e=n,{$gettext:t}=V(),s=C([]),a=C("-");let o="-";const i=C(!1),d=C([]),l=C(""),f=C(""),A=C(),E=(c,v)=>{if(!(v===""||v==="-"||c.find(m=>m.path===v))){let m;c.filter(g=>g.mount&&g.dev&&v.startsWith(g.mount)).forEach(g=>{m&&m.mount.length>g.mount.length||(m=g)}),c.push({path:v,size:m?m.size:void 0})}s.value=c,v!=="-"&&(a.value=v,Y())};a.value=="-"&&(x.localBackupdirPath().then(c=>{if(c){const{code:v,msg:m}=c;v==200&&E(s.value,m)}}),x.getBlockDevices().then(c=>{if(c&&c.code==200){const v=c.data,m=[];for(let g in v){const y=v[g];y.mount&&y.mount!="/"&&y.mount!="/rom"&&y.mount!="/boot"&&y.mount!="/ext_overlay"&&y.mount!="/overlay"&&m.push(y)}m.forEach(g=>{g.path=g.mount+"/istore_backup"}),E(m,m.length>0&&a.value==="-"?"":a.value)}}));const Y=c=>{i.value=!1,a.value==="-"?(o!="-"&&(f.value=o),A.value.focus()):o=a.value},N=c=>{f.value==""?o!="-"?a.value=o:a.value="":f.value.startsWith("/")?E(s.value,f.value):(w(t("please enter the path, give up the input, please clear the input box")),A.value.setSelectionRange(0,f.value.length),A.value.focus())},K=()=>a.value.length>1&&a.value.endsWith("/")?a.value.substring(0,a.value.length-1):a.value,F=()=>{let c=K();if(c==""){w(t("please fill in the external storage directory"));return}i.value=!1,x.backupFileList(c,e.backupType).then(v=>{if(v){const{code:m,msg:g}=v;if(m==200){let y=JSON.parse(g);y.length==0?(w(t("there are no backup files in this path")),i.value=!1):(d.value=y,i.value=!0);return}throw g||"unknown error"}throw"unknown error"}).catch(v=>{w(v)})},j=()=>{let c=K();if(c==""){w(t("please fill in the external storage directory"));return}x.localBackup(c,e.backupType).then(v=>{let m=v.stderr;v.code!==0?w({content:`${m}
${t("backup fail with error code")}: ${v.code}`,keep:!0}):window.istore_log(!1)}).catch(v=>{w({content:`${t("backup fail with error code")}: ${500}`,keep:!0})})},ee=c=>a.value.endsWith("/")?a.value+c:a.value+"/"+c,k=()=>{if(l.value===""){w(t("please select a backup file to restore"));return}B.OVERLAY==e.backupType&&!confirm(t("The system will automatically restart after restore. Do you want to continue?"))||x.localRestore(ee(l.value),e.backupType).then(c=>{let v=c.stderr;c.code!==0?w({content:`${v}
${t("restore failed with error code")}: ${c.code}`,keep:!0}):window.istore_log(!0)}).catch(c=>{w({content:`${t("restore failed with error code")}: ${500}`,keep:!0})})};return(c,v)=>(u(),_("div",za,[r("div",qa,[r("div",Ga,h(p(t)("explain")),1),r("div",Ya,[r("div",Na,[r("div",Ha,[B.ISTORE==e.backupType?(u(),_("span",Qa,"\xB7 "+h(p(t)("backup now backs up installed software to external storage")),1)):$("",!0),B.OVERLAY==e.backupType?(u(),_("span",Wa,"\xB7 "+h(p(t)("backup now backs up system and sandbox to external storage")),1)):$("",!0),B.OVERLAY==e.backupType?(u(),_("span",Ka,"\xB7 "+h(p(t)("includes system configuration and installed packages")),1)):$("",!0),B.OVERLAY==e.backupType?(u(),_("span",Za,"\xB7 "+h(p(t)("it is recommended to perform restore only on the same model")),1)):$("",!0),B.OVERLAY==e.backupType?(u(),_("span",Ja,"\xB7 "+h(p(t)("sandbox backups will not be listed in a non-sandbox environment")),1)):$("",!0),B.OVERLAY==e.backupType?(u(),_("span",Xa,"\xB7 "+h(p(t)("if you want to restore sandbox backups, please enter the sandbox environment first")),1)):$("",!0),r("span",null,"\xB7 "+h(p(t)("no internet required for restore")),1),B.OVERLAY==e.backupType?(u(),_("span",ja,"\xB7 "+h(p(t)("the system will reboot immediately when the restore is complete")),1)):$("",!0)]),r("div",es,h(p(t)("external storage directory"))+" \uFF1A ",1),r("div",ts,[a.value!="-"?R((u(),_("select",{key:0,class:"local-input-field",onChange:Y,"onUpdate:modelValue":v[0]||(v[0]=m=>a.value=m)},[r("option",ns,h(p(t)("choose")),1),(u(!0),_(L,null,z(s.value,(m,g)=>(u(),_("option",{value:m.path,key:g},h(m.path+(m.size?"\uFF08"+m.size+"\uFF09":"")),9,as))),128)),r("option",ss,h(p(t)("customize")),1)],544)),[[Se,a.value,void 0,{trim:!0}]]):R((u(),_("input",{key:1,class:"local-input-field",onBlur:N,onKeyup:Ne(N,["enter"]),placeholder:p(t)("please enter an absolute path starting with %{name}",{name:"/"}),type:"text","onUpdate:modelValue":v[1]||(v[1]=m=>f.value=m),ref_key:"user_input",ref:A},null,40,os)),[[ce,f.value,void 0,{trim:!0}]]),a.value!="-"&&a.value!=""?(u(),_("div",rs,[r("input",{type:"button",class:"app-btn cbi-button cbi-button-apply",onClick:j,value:p(t)("backup now")},null,8,ls),r("input",{type:"button",class:"app-btn cbi-button cbi-button-apply",onClick:F,value:p(t)("restore backup...")},null,8,is)])):$("",!0)]),i.value?(u(),_("div",cs,[r("div",null,h(p(t)("choose backup file"))+" \uFF1A",1),R(r("select",{"onUpdate:modelValue":v[2]||(v[2]=m=>l.value=m)},[(u(!0),_(L,null,z(d.value,m=>(u(),_("option",{key:m,value:m},h(m),9,us))),128))],512),[[Se,l.value,void 0,{trim:!0}]]),r("input",{type:"button",class:"app-btn cbi-button cbi-button-apply",onClick:k,value:p(t)("restore now")},null,8,ds)])):$("",!0)])])])]))}};var Te=T(ps,[["__scopeId","data-v-7f3e9f90"]]);const _s={class:"cbi-map"},vs={class:"cbi-section"},hs={class:"panel-title"},ms={class:"cbi-section"},fs={class:"panel-title"},gs={key:0,class:"cbi-section"},bs={class:"panel-title"},ks={class:"cbi-tabmenu"},ys={onclick:"false",href:"#"},ws={onclick:"false",href:"#"},$s={onclick:"false",href:"#"},xs={__name:"index",setup(n){const{$gettext:e}=V(),t=C(G("backup")?2:4);return(s,a)=>(u(),_("div",_s,[r("fieldset",vs,[r("span",hs,h(p(e)("upgrade"))+" iStore",1),D($a)]),r("fieldset",ms,[r("span",fs,h(p(e)("config"))+" iStore",1),D(Ta)]),p(G)("backup")||p(G)("overlay")?(u(),_("fieldset",gs,[r("span",bs,h(p(e)("app backup")),1),r("ul",ks,[p(G)("backup")?(u(),_("li",{key:0,class:J(t.value==2?"cbi-tab":"cbi-tab-disabled"),onClick:a[0]||(a[0]=o=>t.value=2)},[r("a",ys,h(p(e)("light backup")),1)],2)):$("",!0),p(G)("backup")?(u(),_("li",{key:1,class:J(t.value==3?"cbi-tab":"cbi-tab-disabled"),onClick:a[1]||(a[1]=o=>t.value=3)},[r("a",ws,h(p(e)("local backup")),1)],2)):$("",!0),p(G)("overlay")?(u(),_("li",{key:2,class:J(t.value==4?"cbi-tab":"cbi-tab-disabled"),onClick:a[2]||(a[2]=o=>t.value=4)},[r("a",$s,h(p(e)("system backup")),1)],2)):$("",!0)]),t.value==2?(u(),Z(Ua,{key:0})):$("",!0),t.value==3?(u(),Z(Te,{key:1,backupType:p(B).ISTORE},null,8,["backupType"])):$("",!0),t.value==4?(u(),Z(Te,{key:2,backupType:p(B).OVERLAY},null,8,["backupType"])):$("",!0)])):$("",!0)]))}},Cs=He({history:Qe(I.BasePage()),routes:[{path:"/",redirect:"/installed"},{path:"/installed",name:"Installed",component:Fn},{path:"/store",name:"Store",component:oa},{path:"/upload",name:"Upload",component:da},{path:"/webapps",name:"Webapps",component:ma},{path:"/maintance",name:"Maintance",component:xs},{path:"/:pathMatch(.*)*",name:"notfound",redirect:"/"}]});var Ie,Oe,Pe,Ss={namespaced:!0,state:{Load:!1,LocalApps:[],StoreApps:[],Expand:{},Cur:{tag:"default",sort:"default",search:"",limit:30,offset:0,hide_docker:((Ie=window==null?void 0:window.istore_config)==null?void 0:Ie.hide_docker)||!1,ignore_arch:((Oe=window==null?void 0:window.istore_config)==null?void 0:Oe.ignore_arch)||!1,super_arch:(Pe=window==null?void 0:window.istore_config)==null?void 0:Pe.super_arch},LocalAppsMap:{},StoreAppsMap:{}},mutations:{setExpand(n,e){n.Expand=e},setLocalApps(n,e){e=e||[],n.LocalAppsMap={},e.forEach(a=>{n.LocalAppsMap[a.name]=a});const t=[],s=JSON.parse(window.localStorage&&window.localStorage.getItem("istore.tops")||"[]");s.forEach(a=>{const o=n.LocalAppsMap[a];o&&t.push(o)}),e.sort((a,o)=>o.time-a.time),e.forEach(a=>{s.indexOf(a.name)==-1&&t.push(a)}),n.LocalApps=t},setStoreApps(n,e){n.StoreApps=e||[],e.forEach(t=>{n.StoreAppsMap[t.name]=t})},setCur(n,e){for(const t in e)Object.hasOwnProperty.call(e,t)&&(n.Cur[t]=e[t])}},getters:{Cur(n){return n.Cur},LocalApps(n){let e=[...n.LocalApps],t=n.Expand;for(let s=0;s<e.length;s++){let a=e[s].name;t[a]&&(e[s].expand=t[a]),n.StoreAppsMap[a]&&(e[s].curVersion=e[s].version,e[s].curRelease=e[s].release,e[s].lastVersion=n.StoreAppsMap[a].version,e[s].lastRelease=n.StoreAppsMap[a].release)}return e},StoreApps(n){let e=[...n.StoreApps];G("luci-js")||(e=e.filter(o=>((o==null?void 0:o.depends)||[]).indexOf("luci-js-deps")==-1));let t=n.Expand;for(let o=0;o<e.length;o++){let i=e[o].name;t[i]&&(e[o].expand=t[i]),n.LocalAppsMap[i]&&(e[o].installed=!0,n.LocalAppsMap[i].broken?e[o].broken=n.LocalAppsMap[i].broken:(e[o].lastVersion=e[o].version,e[o].lastRelease=e[o].release,e[o].curVersion=n.LocalAppsMap[i].version,e[o].curRelease=n.LocalAppsMap[i].release))}n.Cur.hide_docker&&(e=e.filter(o=>((o==null?void 0:o.depends)||[]).indexOf("docker-deps")==-1)),!n.Cur.ignore_arch&&n.Cur.super_arch&&(e=e.filter(o=>{const i=(o==null?void 0:o.arch)||["all"];return i.indexOf("all")!=-1?!0:i.indexOf(n.Cur.super_arch)!=-1}));let s=n.Cur.tag;s!="default"&&(e=e.filter(o=>((o==null?void 0:o.tags)||[]).indexOf(s)!=-1));let a=n.Cur.search;switch(a&&(e=e.filter(o=>{let i=JSON.stringify(o);return new RegExp(a,"i").test(i)})),n.Cur.sort){case"download":e=e.sort((o,i)=>{var d,l;return(((d=i==null?void 0:i.expand)==null?void 0:d.downloadCount)||0)-(((l=o==null?void 0:o.expand)==null?void 0:l.downloadCount)||0)});break;case"star":e=e.sort((o,i)=>{var d,l;return(((d=i==null?void 0:i.expand)==null?void 0:d.starCount)||0)-(((l=o==null?void 0:o.expand)==null?void 0:l.starCount)||0)});break;case"updateDate":e=e.sort((o,i)=>i.time-o.time);break}return e}},actions:{incrAppDownload(n,e){const{state:t}=n;t.Expand[e==null?void 0:e.name]&&t.Expand[e==null?void 0:e.name].downloadCount++},incrAppStar(n,e){const{state:t}=n;t!=null&&t.Expand[e==null?void 0:e.name]&&(t.Expand[e==null?void 0:e.name].starCount++,t.Expand[e==null?void 0:e.name].isStar=!0)},filterCurApps(n,e){const{commit:t,dispatch:s}=n;t("setCur",e)},getApps(n){const{state:e,dispatch:t}=n;t("getLocalApps"),t("getStoreApps",e.Cur)},getLocalApps(n){const{commit:e}=n;x.getInstalledApp().then(t=>{Array.isArray(t)?t.forEach(s=>{s.installed=!0}):t=[],e("setLocalApps",t)})},getStoreApps(n,e){const{state:t,commit:s,dispatch:a}=n,o={deviceId:I.getDeviceId(),arch:I.modelArch(),ver:I.getVersion(),feature:I.getFeatures().join(",")};let i=[];x.postStoreAppList(e,o).then(d=>{d.apps&&(d.apps.forEach(l=>{i.push(l.name)}),a("getStoreAppsExpand",i),s("setStoreApps",d.apps)),t.Load=!0}).catch(d=>{console.log(d)})},getStoreAppsExpand(n,e){const{commit:t}=n;x.getAppExpandData(e).then(s=>{s&&t("setExpand",s)})},stickTop(n,e){if(!window.localStorage)return;const t=JSON.parse(window.localStorage.getItem("istore.tops")||"[]");if(t.length>0&&t[0]==e)return;const s=[e];t.forEach(i=>{i!=e&&s.push(i)}),window.localStorage.setItem("istore.tops",JSON.stringify(s));const{state:a,commit:o}=n;o("setLocalApps",a.LocalApps)}}},As={namespaced:!0,state:{Tags:[],Total:0},mutations:{},getters:{Tags(n){return n.Tags},Total(n){return n.Total}},actions:{getTags(n){const{state:e,commit:t}=n;x.getStoreTags().then(s=>{e.Tags=(s==null?void 0:s.tags)||[],e.Total=(s==null?void 0:s.total)||0})}}},Ls=We({state:{version:"",versionLoad:!1},mutations:{setVersion(n,e){n.version=e},setVersionLoad(n,e){n.versionLoad=e}},modules:{apps:Ss,tags:As},actions:{getData(n){const{dispatch:e}=n;e("tags/getTags"),e("apps/getApps"),e("getVersion")},getVersion(n){return b(this,null,function*(){const{commit:e}=n;try{const t=yield x.updateIstore(),{code:s,msg:a}=t==null?void 0:t.data;s==200&&e("setVersion",a)}catch(t){console.log(t)}e("setVersionLoad",!0)})},istoreUpdated(n){const{commit:e}=n;e("setVersion","")}}});const Ts={},Is={width:"16px",height:"16px",viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function Os(n,e,t,s,a,o){return u(),_("svg",Is,e[0]||(e[0]=[r("path",{d:"M14.9234958,14.5525054 L10.84453,10.4679606 C11.8849284,9.46327833 12.5294813,8.07823887 12.5294813,6.55073066 C12.5294813,3.48989918 9.94358337,1 6.76474066,1 C3.58589795,1 1,3.48989918 1,6.55073066 C1,9.61156213 3.58589795,12.1014613 6.76474066,12.1014613 C8.16008242,12.1014613 9.44067838,11.621191 10.438802,10.8242646 L14.5276502,14.9188536 C14.5814545,14.9730393 14.6533765,15 14.725573,15 C14.7942009,15 14.8625542,14.9754182 14.9158095,14.9262546 C15.025065,14.8250198 15.0283592,14.6577049 14.9234958,14.5525054 Z M6.76474066,11.5728203 C3.8886841,11.5728203 1.54902292,9.32001661 1.54902292,6.55073066 C1.54902292,3.7814447 3.8886841,1.52864101 6.76474066,1.52864101 C9.64079723,1.52864101 11.9804584,3.7814447 11.9804584,6.55073066 C11.9804584,9.32001661 9.64052272,11.5728203 6.76474066,11.5728203 Z",id:"Shape",stroke:"#FFFFFF","stroke-width":"1.3"},null,-1)]))}var Ps=T(Ts,[["render",Os]]);const Es={},Ds={width:"12px",height:"12px",viewBox:"0 0 12 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function Vs(n,e,t,s,a,o){return u(),_("svg",Ds,e[0]||(e[0]=[r("path",{d:"M10.171916,3.81818329 C10.6519813,3.81274681 11.1102149,4.01840688 11.4252438,4.38069009 C11.7402726,4.74297329 11.8803105,5.2253253 11.8081406,5.70080197 L11.0555552,10.608963 C10.9332063,11.4157454 10.2351606,12.0090843 9.42537185,12 L3.27269856,12 C2.97145497,12 2.7272488,11.7556885 2.7272488,11.454445 L2.7272488,5.4544976 C2.7272488,5.37817917 2.74326442,5.30271013 2.77426027,5.23296947 L4.95605931,0.323921631 C5.04360472,0.126944443 5.23894201,0 5.4544976,0 C6.65947193,0 7.63629663,0.976824702 7.63629663,2.18179904 L7.63629663,3.81815451 L10.171916,3.81818329 Z M3.81814832,10.9090654 L9.43153778,10.9090654 C9.70352269,10.9121048 9.93620458,10.7143252 9.97712277,10.4445109 L10.7297188,5.53628009 C10.7537339,5.3780602 10.7070546,5.2172762 10.602045,5.09651513 C10.4970353,4.97575406 10.3442908,4.9072007 10.1780925,4.90904784 L7.09084687,4.90904784 C6.78960329,4.90904784 6.54539711,4.66484166 6.54539711,4.36359808 L6.54539711,2.18179904 C6.54539711,1.69494967 6.22647822,1.2825878 5.78615711,1.14223013 L3.81814832,5.57024992 L3.81814832,10.9090654 Z M2.7272488,5.99994736 L1.63634928,5.99994736 C1.33510569,5.99994736 1.09089952,6.24415353 1.09089952,6.54539711 L1.09089952,10.3635454 C1.09089952,10.664789 1.33510569,10.9089952 1.63634928,10.9089952 L2.7272488,10.9089952 L2.7272488,5.99994736 Z M3.27269856,11.9998947 L1.63634928,11.9998947 C0.732618527,11.9998947 -1.03028697e-13,11.2672762 -1.03028697e-13,10.3635454 L-1.03028697e-13,6.54539711 C-1.03028697e-13,5.64166636 0.732618527,4.90904784 1.63634928,4.90904784 L3.27269856,4.90904784 C3.57394214,4.90904784 3.81814832,5.15325401 3.81814832,5.4544976 L3.81814832,11.454445 C3.81814832,11.7556885 3.57394214,11.9998947 3.27269856,11.9998947 Z",id:"Shape",fill:"#FFFFFF","fill-rule":"nonzero"},null,-1)]))}var Bs=T(Es,[["render",Vs]]);const Ms={},Fs={width:"12px",height:"12px",viewBox:"0 0 12 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function Rs(n,e,t,s,a,o){return u(),_("svg",Fs,e[0]||(e[0]=[r("path",{d:"M10.171916,3.81818329 C10.6519813,3.81274681 11.1102149,4.01840688 11.4252438,4.38069009 C11.7402726,4.74297329 11.8803105,5.2253253 11.8081406,5.70080197 L11.0555552,10.608963 C10.9332063,11.4157454 10.2351606,12.0090843 9.42537185,12 L3.27269856,12 C2.97145497,12 2.7272488,11.7556885 2.7272488,11.454445 L2.7272488,5.4544976 C2.7272488,5.37817917 2.74326442,5.30271013 2.77426027,5.23296947 L4.95605931,0.323921631 C5.04360472,0.126944443 5.23894201,0 5.4544976,0 C6.65947193,0 7.63629663,0.976824702 7.63629663,2.18179904 L7.63629663,3.81815451 L10.171916,3.81818329 Z M3.27269856,11.9998947 L1.63634928,11.9998947 C0.732618527,11.9998947 0,11.2672762 0,10.3635454 L0,6.54539711 C0,5.64166636 0.732618527,4.90904784 1.63634928,4.90904784 L3.27269856,4.90904784 C3.57394214,4.90904784 3.81814832,5.15325401 3.81814832,5.4544976 L3.81814832,11.454445 C3.81814832,11.7556885 3.57394214,11.9998947 3.27269856,11.9998947 Z",id:"Shape",fill:"#FFE45A","fill-rule":"nonzero"},null,-1)]))}var Us=T(Ms,[["render",Rs]]);const zs={},qs={viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"20",height:"20"};function Gs(n,e,t,s,a,o){return u(),_("svg",qs,e[0]||(e[0]=[r("title",null,"Docker",-1),r("path",{fill:"currentColor",d:"M560.86064 480h-105.6v-94.4H560.86064V480z m0-326.4h-105.6v97.6H560.86064V153.6z m124.8 232h-105.6V480h105.6v-94.4z m-249.6-115.2h-105.6v96h105.6v-96z m124.8 0h-105.6v96H560.86064v-96z m443.2 160c-22.4-16-76.8-20.8-116.8-12.8-4.8-38.4-27.2-72-65.6-102.4l-22.4-14.4-14.4 22.4c-28.8 44.8-36.8 118.4-6.4 166.4-14.4 8-41.6 17.6-76.8 17.6H4.06064c-14.4 81.6 9.6 187.2 70.4 259.2 59.2 70.4 148.8 105.6 264 105.6 251.2 0 438.4-115.2 524.8-326.4 33.6 0 108.8 0 145.6-72 1.6-3.2 11.2-20.8 12.8-27.2l-17.6-16z m-817.6-44.8H80.86064V480h105.6v-94.4z m124.8 0h-105.6V480h105.6v-94.4z m124.8 0h-105.6V480h105.6v-94.4z m-124.8-115.2h-105.6v96h105.6v-96z"},null,-1)]))}var Ys=T(zs,[["render",Gs]]);const Ns={class:"quickinstalled-dialog"},Hs=["disabled"],Qs={class:"quickinstalled-dialog_main-header"},Ws={class:"quickinstalled-dialog_main-body"},Ks={class:"label-item"},Zs={class:"label-item_label"},Js={class:"label-item_data"},Xs={class:"label-item_radio"},js={class:"label-item_radio"},eo={key:0,class:"label-item"},to={class:"label-item_label"},no={class:"label-item_data"},ao={class:"label-item_radio"},so=["onUpdate:modelValue"],oo={class:"label-item_radio"},ro=["onUpdate:modelValue"],lo={key:1,class:"label-item"},io={class:"label-item_label"},co={class:"label-item_data"},uo={class:"label-item_radio"},po=["value","onUpdate:modelValue"],_o={key:2,class:"label-item"},vo={class:"label-item_label"},ho={class:"label-item_data"},mo={class:"label-item_input"},fo=["onUpdate:modelValue"],go={class:"quickinstalled-dialog_main-footer"},bo={class:"submit"},ko=Ke({__name:"index",props:{app:{},close:{type:Function}},setup(n){const{$gettext:e}=V(),t=n,s=()=>{t.close()},a=c=>{switch(window.vue_lang){case"zh-cn":case"zh-tw":return c.title}return c.title_en||c.title},o=C(!0),i=a(t.app);De(()=>Ze(()=>b(this,null,function*(){try{yield K()}catch(c){}finally{document.body.style.overflow="hidden",o.value=!1}}))),ie(()=>{o.value=!0,document.body.style.overflow=null});const d=M(),l=C({}),f=C(!1),A=C(),E=P(()=>{const c=[];for(const v in A.value)if(Object.prototype.hasOwnProperty.call(A.value,v)){const m=A.value[v];switch(m.mount){case"/rom":case"/overlay":case"/boot":case"/ext_overlay":case"/":break;default:m.mount&&m.mount.startsWith("/")&&c.push(m)}}return c}),Y=()=>b(this,null,function*(){try{const{data:c}=yield x.getBlockDevices();A.value=c||[]}catch(c){w(`${c}`)}}),N=()=>b(this,null,function*(){var v;const c=t.app.autoconf||[];for(let m=0;m<c.length;m++){const g=c[m];switch(g){case"enable":l.value[g]="0";break;case"path":E.value.length>0?((v=window==null?void 0:window.istore_config)==null?void 0:v.last_path)&&window.istore_config.last_path!==""?l.value[g]=window.istore_config.last_path:l.value[g]=E.value[0].mount:l.value[g]=null;break;default:l.value[g]=null}}}),K=()=>b(this,null,function*(){f.value=!0;try{yield Promise.allSettled([Y()])}catch(c){w(`${c}`)}finally{yield N(),f.value=!1}}),F=C(!0),j=()=>b(this,null,function*(){if(!f.value){if(!F.value){yield ee();return}yield k()}}),ee=()=>b(this,null,function*(){const c=t.app.name;t.app.depends.indexOf("docker-deps")!=-1&&!G("docker")&&!confirm(e("Docker is not installed on the system, try to install it?"))||x.installApp(c).then(m=>{let g=m.stderr;m.code!==0?w({content:`${g}
${e("installation failed, error code")}: ${m.code}`,keep:!0}):(x.increasingDownloadCount(c),d.dispatch("apps/incrAppDownload",{name:c}),window.istore_log(!0,y=>{console.log("Install ",c," ",y==0?"successed":"failed")}))}).catch(m=>{w({content:`${e("installation failed, error code")}: ${500}`,keep:!0})})}),k=()=>b(this,null,function*(){for(const c in l.value)if(Object.prototype.hasOwnProperty.call(l.value,c)){const v=l.value[c];if(v==null||v===""){w(`${c} `+e("Can't be empty"));return}}try{f.value=!0;const c=t.app.name;x.increasingDownloadCount(c);const v={package:t.app.name,token:I.getToken(),autoconf:"1"};for(const y in l.value)Object.prototype.hasOwnProperty.call(l.value,y)&&(v[y]=l.value[y]);const{code:m,stderr:g}=yield x.installApp(c,v);if(m===0&&window.istore_log(!0),g)throw g}catch(c){w(`${c}`)}finally{f.value=!1}});return(c,v)=>(u(),Z(Xe,{to:"body"},[r("div",Ns,[v[6]||(v[6]=r("div",{class:"quickinstalled-dialog_bg"},null,-1)),D(Je,{name:"dialog"},{default:Ee(()=>[o.value?$("",!0):(u(),_("form",{key:0,class:"quickinstalled-dialog_main",onSubmit:ue(j,["prevent"]),disabled:f.value},[r("div",Qs,[r("span",null,h(p(e)("Quick install"))+" - "+h(p(i)),1)]),r("div",Ws,[r("div",Ks,[r("div",Zs,[v[2]||(v[2]=r("em",null,"*",-1)),se(" "+h(p(e)("Install and setup")),1)]),r("div",Js,[r("label",Xs,[R(r("input",{type:"radio",value:!0,"onUpdate:modelValue":v[0]||(v[0]=m=>F.value=m)},null,512),[[te,F.value]]),r("span",null,h(p(e)("Quick setup")),1)]),r("label",js,[R(r("input",{type:"radio",value:!1,"onUpdate:modelValue":v[1]||(v[1]=m=>F.value=m)},null,512),[[te,F.value]]),r("span",null,h(p(e)("Install only")),1)])])]),F.value?(u(),_(L,{key:0},[(u(!0),_(L,null,z(l.value,(m,g)=>(u(),_(L,null,[g==="enable"?(u(),_("div",eo,[r("div",to,[v[3]||(v[3]=r("em",null,"*",-1)),se(" "+h(p(e)("Run after install")),1)]),r("div",no,[r("label",ao,[R(r("input",{type:"radio",value:"0","onUpdate:modelValue":y=>l.value[g]=y},null,8,so),[[te,l.value[g]]]),r("span",null,h(p(e)("Stop")),1)]),r("label",oo,[R(r("input",{type:"radio",value:"1","onUpdate:modelValue":y=>l.value[g]=y},null,8,ro),[[te,l.value[g]]]),r("span",null,h(p(e)("Start")),1)])])])):$("",!0)],64))),256)),(u(!0),_(L,null,z(l.value,(m,g)=>(u(),_(L,null,[g==="enable"?(u(),_(L,{key:0},[],64)):g==="path"?(u(),_("div",lo,[r("div",io,[v[4]||(v[4]=r("em",null,"*",-1)),se(" "+h(p(e)("Storage")),1)]),r("div",co,[(u(!0),_(L,null,z(E.value,y=>(u(),_("label",uo,[R(r("input",{type:"radio",value:`${y.mount}`,"onUpdate:modelValue":ne=>l.value[g]=ne},null,8,po),[[te,l.value[g],void 0,{trim:!0}]]),r("span",null,h(y.mount)+" \u3010"+h(y.size)+"\u3011",1)]))),256))])])):(u(),_("div",_o,[r("div",vo,[v[5]||(v[5]=r("em",null,"*",-1)),se(" "+h(g),1)]),r("div",ho,[r("label",mo,[R(r("input",{type:"text","onUpdate:modelValue":y=>l.value[g]=y},null,8,fo),[[ce,l.value[g],void 0,{trim:!0}]])])])]))],64))),256))],64)):$("",!0)]),r("div",go,[r("button",bo,h(p(e)("Install")),1),r("button",{class:"close",type:"button",onClick:s},h(p(e)("Cancel")),1)])],40,Hs))]),_:1})])]))}});var yo=T(ko,[["__scopeId","data-v-aa0623a4"]]),wo={install(n){window.$openGlobalQuickInstalled=e=>{const t=document.createElement("div");document.body.appendChild(t);const s=()=>{Ae(null,t),t.remove()},a=D(yo,ae(H({},e),{close:s}));a.appContext=n._context,Ae(a,t)}}},$o={OpenQuickstartInstallApp:wo};const Q=le(rt);Q.component("svg-search",Ps);Q.component("svg-star-on",Bs);Q.component("svg-star-off",Us);Q.component("svg-docker",Ys);Q.use($o.OpenQuickstartInstallApp);const xo=()=>b(S,null,function*(){yield et(Q),Q.use(Cs).use(Ls),Q.mount("#app")});xo()});export default Co();
